<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Vertex AR Video Schedule - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –≤–∏–¥–µ–æ–∞–Ω–∏–º–∞—Ü–∏–π">
    <title>–í–∏–¥–µ–æ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ - Vertex AR</title>
    
    <!-- Critical CSS for above-the-fold content -->
    <style>
        /* Critical styles for initial render */
        :root {
            --primary-color: #007bff;
            --primary-hover: #0056b3;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #2a2a2a;
            --dark-color: #343a40;
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --border-color: #444;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            --transition-speed: 0.3s;
        }

        [data-theme="light"] {
            --bg-color: #f5f7fa;
            --text-color: #333;
            --border-color: #ddd;
            --light-color: #ffffff;
            --dark-color: #343a40;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.2rem;
            transition: all var(--transition-speed);
        }

        .theme-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .nav-tab {
            color: var(--text-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius);
            transition: all var(--transition-speed);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover {
            background-color: var(--light-color);
        }

        .nav-tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Schedule Controls */
        .schedule-controls {
            background: var(--light-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .control-group input,
        .control-group select {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 0.95rem;
            transition: all var(--transition-speed);
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-speed);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-warning {
            background: var(--warning-color);
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Video List */
        .videos-section {
            background: var(--light-color);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .videos-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .videos-header h2 {
            font-size: 1.5rem;
            color: var(--text-color);
        }

        .videos-grid {
            display: grid;
            gap: 1.5rem;
        }

        .video-card {
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            transition: all var(--transition-speed);
        }

        .video-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
            border-color: var(--primary-color);
        }

        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .video-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .video-meta {
            font-size: 0.85rem;
            color: var(--secondary-color);
            line-height: 1.4;
        }

        .video-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: var(--success-color);
            color: white;
        }

        .status-inactive {
            background: var(--secondary-color);
            color: white;
        }

        .status-archived {
            background: var(--danger-color);
            color: white;
        }

        .schedule-info {
            background: var(--light-color);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }

        .schedule-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .schedule-row:last-child {
            margin-bottom: 0;
        }

        .schedule-label {
            font-weight: 600;
            color: var(--text-color);
        }

        .schedule-value {
            color: var(--secondary-color);
        }

        .video-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .video-actions .btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        /* Loading and Toast */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: var(--secondary-color);
        }

        .loading.show {
            display: block;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background: var(--light-color);
            border-left: 4px solid var(--info-color);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            opacity: 0;
            transform: translateX(100%);
            transition: all var(--transition-speed);
            max-width: 400px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .videos-header {
                flex-direction: column;
                align-items: stretch;
            }

            .video-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üé¨ –í–∏–¥–µ–æ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h1>
            <div class="header-actions">
                <button id="themeToggle" class="theme-toggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
                <a href="/admin" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ Dashboard</a>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <a href="/admin" class="nav-tab">üè† Dashboard</a>
            <a href="/admin/companies" class="nav-tab">üè¢ –ö–æ–º–ø–∞–Ω–∏–∏</a>
            <a href="/admin/clients" class="nav-tab">üë• –ö–ª–∏–µ–Ω—Ç—ã</a>
            <a href="/admin/schedule" class="nav-tab active">üé¨ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</a>
            <a href="/admin/storage" class="nav-tab">üíæ –•—Ä–∞–Ω–∏–ª–∏—â–∞</a>
            <a href="/admin/backups" class="nav-tab">üîí Backup</a>
            <a href="/admin/notifications" class="nav-tab">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
            <a href="/admin/settings" class="nav-tab">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
        </div>

        <!-- Schedule Controls -->
        <section class="schedule-controls">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º</h2>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="schedulerStatus">–°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞</label>
                    <div id="schedulerStatus" class="schedule-value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="control-group">
                    <label for="lastCheck">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</label>
                    <div id="lastCheck" class="schedule-value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="control-group">
                    <label for="activeVideos">–ê–∫—Ç–∏–≤–Ω—ã–µ –≤–∏–¥–µ–æ</label>
                    <div id="activeVideos" class="schedule-value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="control-group">
                    <label for="pendingVideos">–û–∂–∏–¥–∞—é—â–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</label>
                    <div id="pendingVideos" class="schedule-value">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <button onclick="refreshSchedulerStatus()" class="btn btn-primary">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
                <button onclick="triggerArchive()" class="btn btn-warning">üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ</button>
                <button onclick="loadVideos()" class="btn btn-success">üìã –û–±–Ω–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ</button>
            </div>
        </section>

        <!-- Videos Section -->
        <section class="videos-section">
            <div class="videos-header">
                <h2>–í–∏–¥–µ–æ —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º</h2>
                <div>
                    <select id="companyFilter" class="control-group" style="margin: 0; width: 200px;">
                        <option value="">–í—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏</option>
                    </select>
                </div>
            </div>
            
            <div id="loadingIndicator" class="loading">
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...</p>
            </div>
            
            <div id="videosGrid" class="videos-grid">
                <!-- Videos will be loaded here -->
            </div>
        </section>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script>
        // Global variables
        let currentVideos = [];
        let schedulerStatus = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadSchedulerStatus();
            loadVideos();
            loadCompanies();
            
            // Auto-refresh scheduler status every 30 seconds
            setInterval(loadSchedulerStatus, 30000);
        });

        // Theme management
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeToggle(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeToggle(newTheme);
        }

        function updateThemeToggle(theme) {
            const toggle = document.getElementById('themeToggle');
            if (toggle) {
                toggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
                toggle.title = theme === 'dark' ? '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É' : '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Ç–µ–º–Ω—É—é —Ç–µ–º—É';
            }
        }

        // Scheduler status management
        async function loadSchedulerStatus() {
            try {
                const response = await fetch('/videos/scheduler/status', {
                    credentials: 'include'
                });
                
                if (!response.ok) throw new Error('Failed to load scheduler status');
                
                const data = await response.json();
                schedulerStatus = data;
                updateSchedulerDisplay(data);
            } catch (error) {
                console.error('Error loading scheduler status:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞', 'error');
            }
        }

        function updateSchedulerDisplay(data) {
            document.getElementById('schedulerStatus').textContent = data.scheduler_enabled ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ùå –û—Ç–∫–ª—é—á–µ–Ω';
            document.getElementById('lastCheck').textContent = data.last_check ? new Date(data.last_check).toLocaleString('ru-RU') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            
            if (data.video_summary) {
                const summary = data.video_summary;
                const activeCount = summary.status_counts?.active || 0;
                const pendingCount = summary.pending_activation || 0;
                
                document.getElementById('activeVideos').textContent = `${activeCount} –∞–∫—Ç–∏–≤–Ω—ã—Ö`;
                document.getElementById('pendingVideos').textContent = `${pendingCount} –æ–∂–∏–¥–∞—é—Ç`;
            }
        }

        async function refreshSchedulerStatus() {
            showLoading(true);
            await loadSchedulerStatus();
            showLoading(false);
            showToast('–°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
        }

        async function triggerArchive() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏—Å—Ç–µ–∫—à–∏–µ –≤–∏–¥–µ–æ?')) {
                return;
            }

            try {
                const response = await fetch('/videos/scheduler/archive-expired', {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (!response.ok) throw new Error('Failed to archive videos');
                
                const data = await response.json();
                showToast(`–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –≤–∏–¥–µ–æ: ${data.archived_count}`, 'success');
                
                // Refresh data
                loadSchedulerStatus();
                loadVideos();
            } catch (error) {
                console.error('Error archiving videos:', error);
                showToast('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤–∏–¥–µ–æ', 'error');
            }
        }

        // Videos management
        async function loadVideos() {
            showLoading(true);
            
            try {
                const companyFilter = document.getElementById('companyFilter');
                const selectedCompany = companyFilter ? companyFilter.value : '';
                
                // Build query string with filters
                const params = new URLSearchParams();
                if (selectedCompany) {
                    params.append('company_id', selectedCompany);
                }
                
                const queryString = params.toString();
                const url = `/videos${queryString ? '?' + queryString : ''}`;
                
                const response = await fetch(url, {
                    credentials: 'include'
                });
                
                if (!response.ok) throw new Error('Failed to load videos');
                
                const videos = await response.json();
                currentVideos = videos;
                displayVideos(videos);
            } catch (error) {
                console.error('Error loading videos:', error);
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ', 'error');
                displayVideos([]);
            } finally {
                showLoading(false);
            }
        }

        function displayVideos(videos) {
            const grid = document.getElementById('videosGrid');
            
            if (videos.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: var(--secondary-color);">
                        <h3>–ù–µ—Ç –≤–∏–¥–µ–æ —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º</h3>
                        <p>–í–∏–¥–µ–æ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = videos.map(video => createVideoCard(video)).join('');
        }

        function createVideoCard(video) {
            const statusClass = video.status === 'active' ? 'status-active' : 
                             video.status === 'inactive' ? 'status-inactive' : 'status-archived';
            const statusText = video.status === 'active' ? '–ê–∫—Ç–∏–≤–Ω–æ' : 
                            video.status === 'inactive' ? '–ù–µ–∞–∫—Ç–∏–≤–Ω–æ' : '–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ';

            return `
                <div class="video-card">
                    <div class="video-header">
                        <div class="video-info">
                            <h3>–í–∏–¥–µ–æ ${video.id.substring(0, 8)}...</h3>
                            <div class="video-meta">
                                –ü–æ—Ä—Ç—Ä–µ—Ç: ${video.portrait_id.substring(0, 8)}...<br>
                                –°–æ–∑–¥–∞–Ω–æ: ${new Date(video.created_at).toLocaleDateString('ru-RU')}<br>
                                –†–∞–∑–º–µ—Ä: ${video.file_size_mb || 'N/A'} MB
                            </div>
                        </div>
                        <span class="video-status ${statusClass}">${statusText}</span>
                    </div>
                    
                    <div class="schedule-info">
                        <div class="schedule-row">
                            <span class="schedule-label">–ê–∫—Ç–∏–≤–Ω–æ:</span>
                            <span class="schedule-value">${video.is_active ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç'}</span>
                        </div>
                        <div class="schedule-row">
                            <span class="schedule-label">–ù–∞—á–∞–ª–æ:</span>
                            <span class="schedule-value">${video.start_datetime ? new Date(video.start_datetime).toLocaleString('ru-RU') : '–ù–µ –∑–∞–¥–∞–Ω–æ'}</span>
                        </div>
                        <div class="schedule-row">
                            <span class="schedule-label">–û–∫–æ–Ω—á–∞–Ω–∏–µ:</span>
                            <span class="schedule-value">${video.end_datetime ? new Date(video.end_datetime).toLocaleString('ru-RU') : '–ù–µ –∑–∞–¥–∞–Ω–æ'}</span>
                        </div>
                        <div class="schedule-row">
                            <span class="schedule-label">–†–æ—Ç–∞—Ü–∏—è:</span>
                            <span class="schedule-value">${getRotationTypeText(video.rotation_type)}</span>
                        </div>
                    </div>
                    
                    <div class="video-actions">
                        <button onclick="editVideoSchedule('${video.id}')" class="btn btn-primary">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button>
                        <button onclick="viewVideoHistory('${video.id}')" class="btn btn-secondary">üìú –ò—Å—Ç–æ—Ä–∏—è</button>
                        ${video.is_active ? `<button onclick="deactivateVideo('${video.id}')" class="btn btn-warning">‚è∏Ô∏è –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>` : 
                          `<button onclick="activateVideo('${video.id}')" class="btn btn-success">‚ñ∂Ô∏è –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>`}
                    </div>
                </div>
            `;
        }

        function getRotationTypeText(type) {
            const types = {
                'none': '–ë–µ–∑ —Ä–æ—Ç–∞—Ü–∏–∏',
                'sequential': '–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è',
                'cyclic': '–¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è'
            };
            return types[type] || type;
        }

        async function editVideoSchedule(videoId) {
            // This would open a modal for editing schedule
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        async function viewVideoHistory(videoId) {
            // This would show video history
            showToast('–ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        async function activateVideo(videoId) {
            try {
                const response = await fetch(`/videos/${videoId}/activate`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (!response.ok) throw new Error('Failed to activate video');
                
                showToast('–í–∏–¥–µ–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                loadVideos();
                loadSchedulerStatus();
            } catch (error) {
                console.error('Error activating video:', error);
                showToast('–û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏–¥–µ–æ', 'error');
            }
        }

        async function deactivateVideo(videoId) {
            try {
                const response = await fetch(`/videos/${videoId}/deactivate`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (!response.ok) throw new Error('Failed to deactivate video');
                
                showToast('–í–∏–¥–µ–æ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                loadVideos();
                loadSchedulerStatus();
            } catch (error) {
                console.error('Error deactivating video:', error);
                showToast('–û—à–∏–±–∫–∞ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏–¥–µ–æ', 'error');
            }
        }

        // Companies management
        async function loadCompanies() {
            const select = document.getElementById('companyFilter');
            
            try {
                const response = await fetch('/companies', {
                    credentials: 'include'
                });
                
                if (!response.ok) throw new Error('Failed to load companies');
                
                const data = await response.json();
                const companies = data.items || [];
                
                select.innerHTML = '<option value="">–í—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏</option>';
                companies.forEach(company => {
                    const option = document.createElement('option');
                    option.value = company.id;
                    option.textContent = company.name;
                    select.appendChild(option);
                });
                
                // Add change listener to reload videos when filter changes
                select.addEventListener('change', loadVideos);
            } catch (error) {
                console.error('Error loading companies:', error);
                // Fallback to placeholder
                select.innerHTML = '<option value="">–í—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏</option>';
            }
        }

        // Utility functions
        function showLoading(show) {
            const loading = document.getElementById('loadingIndicator');
            if (loading) {
                loading.classList.toggle('show', show);
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            const colors = {
                success: 'var(--success-color)',
                error: 'var(--danger-color)',
                warning: 'var(--warning-color)',
                info: 'var(--info-color)'
            };
            
            toast.style.borderLeft = `4px solid ${colors[type] || colors.info}`;
            container.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => container.removeChild(toast), 300);
            }, 3000);
        }

        // Theme toggle event listener
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    </script>
</body>
</html>