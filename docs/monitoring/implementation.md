# –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ê–≤–∞—Ä–∏–π–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ SMTP (Gmail, Outlook, etc.)
- **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä–æ–≥–∏** –¥–ª—è CPU, –ø–∞–º—è—Ç–∏, –¥–∏—Å–∫–∞
- **–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞** (cooldown 5 –º–∏–Ω—É—Ç)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- **CPU**: –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **–ü–∞–º—è—Ç—å**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM –∏ —Å–≤–æ–ø
- **–î–∏—Å–∫**: —Å–≤–æ–±–æ–¥–Ω–æ–µ/–∑–∞–Ω—è—Ç–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- **–°–µ—Ä–≤–∏—Å—ã**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, MinIO
- **–ü—Ä–æ—Ü–µ—Å—Å**: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–°–µ—Ç—å**: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ/–∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞

### 3. –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î**: –∫–æ–º–ø–∞–Ω–∏–∏, –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ—Ä—Ç—Ä–µ—Ç—ã, –≤–∏–¥–µ–æ
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, —Ç–æ–ø –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**: —Å—Ä–µ–¥–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ –Ω–µ–¥–µ–ª—é
- **–û–ø–æ–≤–µ—â–µ–Ω–∏—è**: —Å–≤–æ–¥–∫–∞ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: —Å–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### 4. –ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å
- **–†–∞–∑–¥–µ–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** –≤ –∞–¥–º–∏–Ω—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
- **–ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è–º–∏** –∏ –ø–æ—Ä–æ–≥–∞–º–∏
- **–ò—Å—Ç–æ—Ä–∏—è –æ–ø–æ–≤–µ—â–µ–Ω–∏–π** –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–∞–Ω–∞–ª–æ–≤ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤** –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é

### 5. API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```
GET  /monitoring/status          # –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã (+ runtime settings)
GET  /monitoring/metrics         # –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
GET  /monitoring/alerts          # –ò—Å—Ç–æ—Ä–∏—è –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
POST /monitoring/test-alert      # –¢–µ—Å—Ç–æ–≤–æ–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
POST /monitoring/send-report     # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
PUT  /monitoring/thresholds     # –û–±–Ω–æ–≤–∏—Ç—å –ø–æ—Ä–æ–≥–∏ (persisted)
PUT  /monitoring/settings       # –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (persisted)
GET  /monitoring/stats          # –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET  /monitoring/hotspots       # –ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
GET  /monitoring/memory-leaks   # –°–Ω—ç–ø—à–æ—Ç—ã –ø–∞–º—è—Ç–∏ (tracemalloc)
POST /monitoring/memory-snapshot # –í—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞—Ç—å —Å–Ω—ç–ø—à–æ—Ç –ø–∞–º—è—Ç–∏
```

### 6. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (v1.6+)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏—è** –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–µ—Ä–µ–∑ asyncio.Lock
- **Cooldown** –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30—Å)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –°–º. [Persistent Settings Documentation](./persistent-settings.md)

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **FastAPI** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏
- **psutil** –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- **aiosmtplib** –¥–ª—è email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **aiohttp** –¥–ª—è Telegram API
- **SQLAlchemy** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç—á–µ—Ç–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** –≤—Å–µ—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- **–•—Ä–∞–Ω–µ–Ω–∏–µ** —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **Rate limiting** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** (< 1% CPU)

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
ALERTING_ENABLED=true        # –í–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
# –ü–æ—Ä–æ–≥–∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
CPU_THRESHOLD=80.0
MEMORY_THRESHOLD=85.0
DISK_THRESHOLD=90.0
HEALTH_CHECK_INTERVAL=60

# Email –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
ADMIN_EMAILS=admin@example.com

# Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
WEEKLY_REPORT_DAY=monday
WEEKLY_REPORT_TIME=09:00
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å–∏—Å—Ç–µ–º—ã:
```bash
python test_monitoring.py
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á–µ—Ç–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
```
üî¥ **HIGH**

CPU usage: 95.2% (threshold: 80%)
Memory usage: 87.5% (1.2GB / 1.4GB)
```

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
```
üìä VERTEX AR WEEKLY REPORT
==================================================
üìÖ Period: 2025-11-17 to 2025-11-20
üåê Server: https://your-domain.com

üìà DATABASE STATISTICS
‚Ä¢ Companies: 5
‚Ä¢ Clients: 23
‚Ä¢ Portraits: 156
‚Ä¢ Videos: 312

üíª SYSTEM PERFORMANCE
‚Ä¢ CPU Usage: 15.3%
‚Ä¢ Memory Usage: 45.2%
‚Ä¢ Disk Usage: 23.7%

üö® ALERT SUMMARY (Last 7 Days)
‚Ä¢ Total Alerts: 3
‚Ä¢ High CPU: 2
‚Ä¢ High Memory: 1
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
```bash
pip install psutil aiosmtplib
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env**:
```bash
ALERTING_ENABLED=true
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
ADMIN_EMAILS=admin@example.com
```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:
```bash
uvicorn app.main:app --reload
```

4. **–û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω—Å–∫—É—é –ø–∞–Ω–µ–ª—å**:
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è"

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —É–∑–Ω–∞–µ—Ç–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Ä–∞–Ω—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã** - —ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä—É—á–Ω–æ–π —Å–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- **–ú—É–ª—å—Ç–∏–∫–∞–Ω–∞–ª—å–Ω—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è** - –Ω–∞–¥–µ–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –ª—é–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UI** - —É–¥–æ–±–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω—Å–∫—É—é –ø–∞–Ω–µ–ª—å
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è** - –Ω–µ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production —Å—Ä–µ–¥–µ!

## üîç –ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ (v1.7+)

### –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≥–ª—É–±–æ–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (Deep Resource Diagnostics) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —É–∑–∫–∏—Ö –º–µ—Å—Ç –∏ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (Process History)
- **–ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è**: CPU% –∏ RSS –ø–∞–º—è—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: Ring buffer –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N —Å–Ω—ç–ø—à–æ—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100)
- **–ú–µ—Ç—Ä–∏–∫–∏**: –°—Ä–µ–¥–Ω–∏–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ/–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ç—Ä–µ–Ω–¥—ã
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å –∞–Ω–æ–º–∞–ª—å–Ω—ã–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤

#### 2. –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (Slow Queries)
- **–ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è**: SQL –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –ø–æ—Ä–æ–≥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100ms)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: Top N —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- **–ú–µ—Ç—Ä–∏–∫–∏**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î, –∏–Ω–¥–µ–∫—Å—ã, query optimization

#### 3. –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (Slow Endpoints)
- **–ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è**: HTTP –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –ø–æ—Ä–æ–≥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1000ms)
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: Top N —Å–∞–º—ã—Ö –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- **–ú–µ—Ç—Ä–∏–∫–∏**: –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –º–µ—Ç–æ–¥, –ø—É—Ç—å, —Å—Ç–∞—Ç—É—Å
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API

#### 4. –°–Ω—ç–ø—à–æ—Ç—ã –ø–∞–º—è—Ç–∏ (Memory Snapshots)
- **–ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è**: Tracemalloc –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –ø–∞–º—è—Ç–∏
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–Ω—ç–ø—à–æ—Ç–æ–≤
- **–ú–µ—Ç—Ä–∏–∫–∏**: Top N –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–∞–º—è—Ç–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ç–µ—á–µ–∫
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è RAM
- **‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ**: –î–æ–±–∞–≤–ª—è–µ—Ç ~10% overhead, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
MONITORING_PROCESS_HISTORY_SIZE=100          # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω—ç–ø—à–æ—Ç–æ–≤

# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
MONITORING_SLOW_QUERY_THRESHOLD_MS=100       # –ü–æ—Ä–æ–≥ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
MONITORING_SLOW_QUERY_RING_SIZE=50           # –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞

# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
MONITORING_SLOW_ENDPOINT_THRESHOLD_MS=1000   # –ü–æ—Ä–æ–≥ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
MONITORING_SLOW_ENDPOINT_RING_SIZE=50        # –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞

# Tracemalloc (memory profiling)
MONITORING_TRACEMALLOC_ENABLED=false         # –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
MONITORING_TRACEMALLOC_THRESHOLD_MB=100      # –ü–æ—Ä–æ–≥ –ø–∞–º—è—Ç–∏ (MB)
MONITORING_TRACEMALLOC_TOP_N=10              # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ top –∞–ª–ª–æ–∫–∞—Ü–∏–π
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

#### –ü–æ–ª—É—á–µ–Ω–∏–µ hotspots (—É–∑–∫–∏—Ö –º–µ—Å—Ç)
```bash
GET /api/monitoring/hotspots
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "data": {
    "config": {
      "slow_query_threshold_ms": 100,
      "slow_endpoint_threshold_ms": 1000,
      "tracemalloc_enabled": false
    },
    "diagnostics": {
      "process_trends": {
        "1234": {
          "cpu_avg": 45.5,
          "cpu_max": 78.2,
          "rss_avg_mb": 512.3
        }
      },
      "slow_queries": {
        "count": 5,
        "queries": [
          {
            "timestamp": "2025-01-15T10:30:00",
            "query": "SELECT * FROM portraits WHERE...",
            "duration_ms": 234.5,
            "params": "('client_id',)"
          }
        ]
      },
      "slow_endpoints": {
        "count": 3,
        "endpoints": [
          {
            "timestamp": "2025-01-15T10:32:00",
            "method": "GET",
            "path": "/api/portraits/admin/list-with-preview",
            "duration_ms": 1523.2,
            "status_code": 200
          }
        ]
      }
    }
  }
}
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–Ω—ç–ø—à–æ—Ç–æ–≤ –ø–∞–º—è—Ç–∏
```bash
GET /api/monitoring/memory-leaks
```

**–û—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "data": {
    "enabled": true,
    "current_memory_mb": 156.3,
    "threshold_mb": 100,
    "snapshot_count": 3,
    "snapshots": [
      {
        "timestamp": "2025-01-15T10:35:00",
        "memory_mb": 158.2,
        "top_allocations": [
          {
            "file": "app/database.py:245",
            "size_mb": 23.5,
            "count": 1250
          }
        ]
      }
    ]
  }
}
```

#### –†—É—á–Ω–æ–π —Ç—Ä–∏–≥–≥–µ—Ä —Å–Ω—ç–ø—à–æ—Ç–∞
```bash
POST /api/monitoring/memory-snapshot
```

### Prometheus –º–µ—Ç—Ä–∏–∫–∏

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è Grafana:

```prometheus
# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
vertex_ar_slow_queries_count                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö
vertex_ar_slow_queries_slowest_ms               # –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π (ms)

# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
vertex_ar_slow_endpoints_count                  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö
vertex_ar_slow_endpoints_slowest_ms             # –°–∞–º—ã–π –º–µ–¥–ª–µ–Ω–Ω—ã–π (ms)

# –°–Ω—ç–ø—à–æ—Ç—ã –ø–∞–º—è—Ç–∏
vertex_ar_memory_snapshots_count                # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–Ω—ç–ø—à–æ—Ç–æ–≤

# –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
vertex_ar_process_history_count                 # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
vertex_ar_process_trend_cpu_avg{pid}           # –°—Ä–µ–¥–Ω–∏–π CPU –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É
vertex_ar_process_trend_rss_mb{pid}            # –°—Ä–µ–¥–Ω—è—è –ø–∞–º—è—Ç—å –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
curl -H "Cookie: authToken=..." /api/monitoring/hotspots

# –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
# - –ö–∞–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å–∞–º—ã–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ?
# - –ï—Å—Ç—å –ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤—Ä–µ–º—è —Å—É—Ç–æ–∫)?
# - –ú–æ–∂–Ω–æ –ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?
```

#### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
curl -H "Cookie: authToken=..." /api/monitoring/hotspots

# –î–µ–π—Å—Ç–≤–∏—è
# - –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏
# - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å JOIN'—ã
# - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EXPLAIN –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
```

#### 3. –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
```bash
# 1. –í–∫–ª—é—á–∏—Ç—å tracemalloc (–≤ .env)
MONITORING_TRACEMALLOC_ENABLED=true
MONITORING_TRACEMALLOC_THRESHOLD_MB=50

# 2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–∫–∞ –ø–∞–º—è—Ç—å –ø—Ä–µ–≤—ã—Å–∏—Ç –ø–æ—Ä–æ–≥ –∏–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é
curl -X POST -H "Cookie: authToken=..." /api/monitoring/memory-snapshot

# 3. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–Ω—ç–ø—à–æ—Ç—ã
curl -H "Cookie: authToken=..." /api/monitoring/memory-leaks

# 4. –ò—Å–∫–∞—Ç—å –≤ top_allocations —Ñ–∞–π–ª—ã/—Ñ—É–Ω–∫—Ü–∏–∏ —Å –∞–Ω–æ–º–∞–ª—å–Ω—ã–º–∏ –∞–ª–ª–æ–∫–∞—Ü–∏—è–º–∏
```

### Best Practices

**‚úÖ Production**:
- `MONITORING_TRACEMALLOC_ENABLED=false` (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ)
- `MONITORING_SLOW_QUERY_THRESHOLD_MS=100-200` (–±–∞–ª–∞–Ω—Å overhead/–¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å)
- `MONITORING_SLOW_ENDPOINT_THRESHOLD_MS=1000-2000` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ-–∫—Ä–∏—Ç–∏—á–Ω—ã–µ)

**‚úÖ Development/Debugging**:
- `MONITORING_TRACEMALLOC_ENABLED=true` (–≤—Ä–µ–º–µ–Ω–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ç–µ—á–µ–∫)
- `MONITORING_SLOW_QUERY_THRESHOLD_MS=50` (–±–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)
- `MONITORING_SLOW_QUERY_RING_SIZE=100+` (–±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö)

**‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å `/api/monitoring/hotspots`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –≤ Prometheus/Grafana –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ `vertex_ar_slow_*`
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–Ω—ç–ø—à–æ—Ç—ã –∏ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ structlog:
```
[INFO] Memory snapshot taken memory_mb=158.2 threshold_mb=100 top_allocations_count=10
[INFO] Slow query detected query="SELECT * FROM..." duration_ms=234.5
[INFO] Slow endpoint detected method=GET path=/api/users duration_ms=1523.2
```

## üîó –°–º. —Ç–∞–∫–∂–µ

–ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Beszel, Prometheus, Grafana) –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É —Ä–µ—à–µ–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ [BESZEL_MONITORING_ANALYSIS.md](BESZEL_MONITORING_ANALYSIS.md).
