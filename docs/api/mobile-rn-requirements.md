# –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è React Native

**–í–µ—Ä—Å–∏—è API:** 1.3.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024  
**–¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞:** React Native (iOS/Android)

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–±–∏–ª—å–Ω–æ–≥–æ AR-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ React Native –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –≤ Vertex AR.

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AR-–∫–æ–Ω—Ç–µ–Ω—Ç–∞

Vertex AR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é **AR.js** —Å NFT (Natural Feature Tracking) –º–∞—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ:

1. –ó–∞–≥—Ä—É–∂–∞—Ç—å NFT –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –≤–∏–¥–µ–æ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏
3. –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
4. –†–∞–±–æ—Ç–∞—Ç—å –æ—Ñ–ª–∞–π–Ω (–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö)

### 2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è AR.js

**AR.js** - —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –≤–µ–±-AR, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –Ω–∞ –±–∞–∑–µ:
- **WebGL** –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- **WebRTC** –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ
- **NFT –º–∞—Ä–∫–µ—Ä—ã** –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–î–ª—è React Native –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
- `react-native-webview` –∏–ª–∏
- –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AR (ARCore/ARKit)

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

#### Company (–ö–æ–º–ø–∞–Ω–∏—è)
```json
{
  "id": "uuid",
  "name": "string",
  "created_at": "ISO8601 timestamp"
}
```

#### Client (–ö–ª–∏–µ–Ω—Ç)
```json
{
  "id": "uuid",
  "company_id": "uuid",
  "phone": "string",
  "name": "string",
  "created_at": "ISO8601 timestamp"
}
```

#### Portrait (–ü–æ—Ä—Ç—Ä–µ—Ç/AR-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
```json
{
  "id": "uuid",
  "client_id": "uuid",
  "permanent_link": "string",
  "image_path": "string (relative path)",
  "image_preview_path": "string (relative path)",
  "marker_fset": "string (path to .fset file)",
  "marker_fset3": "string (path to .fset3 file)",
  "marker_iset": "string (path to .iset file)",
  "qr_code": "string (base64 encoded PNG)",
  "view_count": "integer",
  "created_at": "ISO8601 timestamp"
}
```

#### Video (–í–∏–¥–µ–æ –¥–ª—è AR)
```json
{
  "id": "uuid",
  "portrait_id": "uuid",
  "video_path": "string (relative path)",
  "video_preview_path": "string (relative path)",
  "description": "string (optional)",
  "is_active": "boolean",
  "created_at": "ISO8601 timestamp",
  "file_size_mb": "integer (optional)"
}
```

---

## üîå API Endpoints –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤

**Endpoint:** `GET /api/mobile/portraits`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `company_id` (optional) - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–æ–º–ø–∞–Ω–∏–∏
- `client_id` (optional) - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–ª–∏–µ–Ω—Ç—É
- `include_inactive` (optional, default: false) - –≤–∫–ª—é—á–∏—Ç—å –ø–æ—Ä—Ç—Ä–µ—Ç—ã –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–∏–¥–µ–æ

**Response:**
```json
{
  "portraits": [
    {
      "id": "portrait-uuid",
      "permanent_link": "portrait_abc123",
      "client": {
        "id": "client-uuid",
        "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "phone": "+79991234567"
      },
      "image": {
        "url": "https://example.com/storage/portraits/client-uuid/portrait-uuid.jpg",
        "preview_url": "https://example.com/storage/portraits/client-uuid/portrait-uuid_preview.webp",
        "width": 1920,
        "height": 1080
      },
      "markers": {
        "fset": "https://example.com/nft-markers/portrait-uuid/portrait-uuid.fset",
        "fset3": "https://example.com/nft-markers/portrait-uuid/portrait-uuid.fset3",
        "iset": "https://example.com/nft-markers/portrait-uuid/portrait-uuid.iset"
      },
      "active_video": {
        "id": "video-uuid",
        "url": "https://example.com/storage/videos/portrait-uuid/video-uuid.mp4",
        "preview_url": "https://example.com/storage/videos/portrait-uuid/video-uuid_preview.webp",
        "description": "–í–∏–¥–µ–æ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ",
        "file_size_mb": 15,
        "duration_seconds": 30
      },
      "qr_code": "data:image/png;base64,iVBORw0KG...",
      "view_count": 42,
      "created_at": "2024-01-15T10:30:00Z"
    }
  ],
  "total": 1,
  "page": 1,
  "page_size": 20
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ –ø–æ permanent_link

**Endpoint:** `GET /api/mobile/portraits/{permanent_link}`

**Response:** –û–±—ä–µ–∫—Ç –ø–æ—Ä—Ç—Ä–µ—Ç–∞ (—Å–º. –≤—ã—à–µ)

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

**Endpoint:** `POST /api/mobile/portraits/{portrait_id}/view`

**Body:**
```json
{
  "timestamp": "ISO8601",
  "duration_seconds": 15,
  "device_info": {
    "platform": "ios|android",
    "os_version": "15.0",
    "app_version": "1.0.0"
  }
}
```

**Response:**
```json
{
  "success": true,
  "view_count": 43
}
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–π

**Endpoint:** `GET /api/mobile/companies`

**Response:**
```json
{
  "companies": [
    {
      "id": "company-uuid",
      "name": "Vertex AR",
      "portraits_count": 150,
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

---

## üé® –†–µ—Å—É—Ä—Å—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

### 1. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–û—Ä–∏–≥–∏–Ω–∞–ª:** `/storage/portraits/{client_id}/{portrait_id}.jpg`
- **Preview:** `/storage/portraits/{client_id}/{portrait_id}_preview.webp` (300x300px)
- **–§–æ—Ä–º–∞—Ç:** JPG (–æ—Ä–∏–≥–∏–Ω–∞–ª), WebP (preview)

### 2. –í–∏–¥–µ–æ
- **–û—Ä–∏–≥–∏–Ω–∞–ª:** `/storage/videos/{portrait_id}/{video_id}.mp4`
- **Preview:** `/storage/videos/{portrait_id}/{video_id}_preview.webp`
- **–§–æ—Ä–º–∞—Ç:** MP4 (H.264)
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** 720p-1080p
- **–ë–∏—Ç—Ä–µ–π—Ç:** 2-5 Mbps

### 3. NFT –ú–∞—Ä–∫–µ—Ä—ã
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ä—Ç—Ä–µ—Ç–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è 3 —Ñ–∞–π–ª–∞:

- **`.fset`** - Feature Set (–æ—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- **`.fset3`** - Feature Set Level 3 (–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- **`.iset`** - Image Set (—Å–∂–∞—Ç–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `/nft-markers/{portrait_id}/`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ AR.js:**
```html
<a-nft
  type="nft"
  url="/nft-markers/portrait-uuid/portrait-uuid"
  smooth="true"
  smoothCount="10"
  smoothTolerance="0.01"
  smoothThreshold="5"
>
  <a-video
    src="#video"
    position="0 0 0"
    width="1"
    height="1"
    rotation="-90 0 0"
  ></a-video>
</a-nft>
```

### 4. QR –∫–æ–¥—ã
- **–§–æ—Ä–º–∞—Ç:** Base64-encoded PNG
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:** URL –≤–∏–¥–∞ `https://example.com/portrait/{permanent_link}`
- **–†–∞–∑–º–µ—Ä:** 300x300px
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ AR –∫–æ–Ω—Ç–µ–Ω—Ç—É —á–µ—Ä–µ–∑ –∫–∞–º–µ—Ä—É

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
–ü–æ—Ä—Ç—Ä–µ—Ç—ã —Å `permanent_link` –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
```
GET /portrait/{permanent_link}
```

### API –¥–æ—Å—Ç—É–ø (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω)
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º:
```
Authorization: Bearer {access_token}
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
```http
POST /auth/login
Content-Type: application/json

{
  "username": "user",
  "password": "password"
}
```

**Response:**
```json
{
  "access_token": "eyJhbGc...",
  "token_type": "bearer"
}
```

---

## üì± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ç–µ–∫

```
React Native (0.72+)
‚îú‚îÄ‚îÄ react-native-webview (WebGL AR.js)
‚îú‚îÄ‚îÄ react-native-fs (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)
‚îú‚îÄ‚îÄ @react-native-async-storage/async-storage (–∫–µ—à)
‚îú‚îÄ‚îÄ react-native-qrcode-scanner (QR —Å–∫–∞–Ω–µ—Ä)
‚îî‚îÄ‚îÄ axios (HTTP –∫–ª–∏–µ–Ω—Ç)
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ù–∞—Ç–∏–≤–Ω—ã–π AR

```
React Native (0.72+)
‚îú‚îÄ‚îÄ react-native-viro (ARCore/ARKit)
‚îú‚îÄ‚îÄ –∏–ª–∏ ViroReact
‚îî‚îÄ‚îÄ –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è NFT –º–∞—Ä–∫–µ—Ä–æ–≤
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã

1. **–°–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤** - –≥–∞–ª–µ—Ä–µ—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ AR –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. **AR Scanner** - –∫–∞–º–µ—Ä–∞ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **QR Scanner** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR –∫–æ–¥–æ–≤
4. **–î–µ—Ç–∞–ª–∏ –ø–æ—Ä—Ç—Ä–µ—Ç–∞** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** - –≤—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏, –∫–µ—à

---

## üíæ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### –ß—Ç–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:

1. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤** (JSON) - 7 –¥–Ω–µ–π
2. **Preview –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (WebP) - 30 –¥–Ω–µ–π
3. **NFT –º–∞—Ä–∫–µ—Ä—ã** (.fset, .fset3, .iset) - –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
4. **–í–∏–¥–µ–æ** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø–æ –≤—ã–±–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤:

- Portrait preview: ~50-100 KB (WebP)
- NFT –º–∞—Ä–∫–µ—Ä—ã (–≤—Å–µ 3 —Ñ–∞–π–ª–∞): ~500 KB - 2 MB
- Video preview: ~100-200 KB (WebP)
- Video full: 5-50 MB (MP4)

**–û—Ü–µ–Ω–∫–∞:** 
- 100 –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏: ~100-200 MB
- 100 –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ —Å –≤–∏–¥–µ–æ: ~1-5 GB

---

## üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### Initial Load (–ø–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
```
1. GET /api/mobile/companies ‚Üí –≤—ã–±–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏
2. GET /api/mobile/portraits?company_id=X ‚Üí —Å–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤
3. –ó–∞–≥—Ä—É–∑–∫–∞ preview –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. –§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ NFT –º–∞—Ä–∫–µ—Ä–æ–≤ (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)
```

### Incremental Update (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
```
1. GET /api/mobile/portraits?updated_since=2024-01-15T10:00:00Z
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤
3. –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∏–∑ –∫–µ—à–∞
```

### Offline Mode
```
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π view –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
- –ò–Ω–¥–∏–∫–∞—Ü–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

## üé• –†–∞–±–æ—Ç–∞ —Å AR –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AR.js**
```javascript
const arScene = new ARScene({
  markerUrl: '/nft-markers/portrait-uuid/portrait-uuid',
  videoUrl: '/storage/videos/...'
});
```

2. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞**
```javascript
arScene.on('markerFound', (marker) => {
  // –ù–∞—á–∞—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–µ–æ
  videoElement.play();
  // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ view
  trackView(marker.portraitId);
});
```

3. **–ü–æ—Ç–µ—Ä—è –º–∞—Ä–∫–µ—Ä–∞**
```javascript
arScene.on('markerLost', (marker) => {
  // –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–∏–¥–µ–æ
  videoElement.pause();
});
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ** –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º AR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- **–£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã** –¥–ª—è —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (640x480 –≤–º–µ—Å—Ç–æ 1280x720)
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FPS** –¥–æ 30fps
- **Adaptive quality** - —Å–Ω–∏–∂–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º FPS

---

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **portrait_viewed** - –ø–æ—Ä—Ç—Ä–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω –≤ AR
2. **portrait_scanned** - QR –∫–æ–¥ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω
3. **video_started** - –≤–∏–¥–µ–æ –Ω–∞—á–∞–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
4. **video_completed** - –≤–∏–¥–µ–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ –¥–æ –∫–æ–Ω—Ü–∞
5. **marker_scan_duration** - –≤—Ä–µ–º—è –¥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –º–∞—Ä–∫–µ—Ä–∞

### –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:
```json
{
  "event": "portrait_viewed",
  "portrait_id": "uuid",
  "timestamp": "ISO8601",
  "session_id": "uuid",
  "duration_seconds": 15,
  "device": {
    "platform": "ios",
    "model": "iPhone 14",
    "os_version": "16.0"
  },
  "ar_info": {
    "scan_time_ms": 1500,
    "fps_average": 28,
    "marker_lost_count": 2
  }
}
```

---

## üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ endpoints

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
```http
HEAD /storage/portraits/{client_id}/{portrait_id}.jpg
```
**Response Headers:**
- `Content-Length`: —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
- `Content-Type`: image/jpeg
- `Last-Modified`: –¥–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ä–∞
```http
GET /api/mobile/portraits/{portrait_id}/marker-status
```
**Response:**
```json
{
  "available": true,
  "files": {
    "fset": { "size": 850000, "updated_at": "2024-01-15T10:00:00Z" },
    "fset3": { "size": 650000, "updated_at": "2024-01-15T10:00:00Z" },
    "iset": { "size": 450000, "updated_at": "2024-01-15T10:00:00Z" }
  },
  "total_size_mb": 1.85
}
```

---

## üîó –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### React Native WebView –ø–æ–¥—Ö–æ–¥

```jsx
import React from 'react';
import { WebView } from 'react-native-webview';

const ARViewer = ({ portraitId, markerUrl, videoUrl }) => {
  const html = `
    <!DOCTYPE html>
    <html>
      <head>
        <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.5/aframe/build/aframe-ar-nft.js"></script>
      </head>
      <body style="margin: 0; overflow: hidden;">
        <a-scene
          vr-mode-ui="enabled: false"
          renderer="logarithmicDepthBuffer: true;"
          embedded
          arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
        >
          <a-assets>
            <video id="vid" src="${videoUrl}" preload="auto" loop crossorigin="anonymous" playsinline></video>
          </a-assets>

          <a-nft
            type="nft"
            url="${markerUrl}"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5"
          >
            <a-video
              src="#vid"
              position="0 0 0"
              width="1"
              height="1"
              rotation="-90 0 0"
            ></a-video>
          </a-nft>

          <a-entity camera></a-entity>
        </a-scene>
      </body>
    </html>
  `;

  return (
    <WebView
      source={{ html }}
      mediaPlaybackRequiresUserAction={false}
      allowsInlineMediaPlayback
      javaScriptEnabled
      domStorageEnabled
    />
  );
};
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

```javascript
import RNFS from 'react-native-fs';
import AsyncStorage from '@react-native-async-storage/async-storage';

const downloadMarkerFiles = async (portraitId, markerUrls) => {
  const cacheDir = `${RNFS.DocumentDirectoryPath}/markers/${portraitId}`;
  
  // –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  await RNFS.mkdir(cacheDir);
  
  // –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –º–∞—Ä–∫–µ—Ä–∞
  for (const [fileType, url] of Object.entries(markerUrls)) {
    const filePath = `${cacheDir}/${portraitId}.${fileType}`;
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
    const exists = await RNFS.exists(filePath);
    if (!exists) {
      await RNFS.downloadFile({
        fromUrl: url,
        toFile: filePath
      }).promise;
    }
  }
  
  // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  await AsyncStorage.setItem(
    `marker_${portraitId}`,
    JSON.stringify({
      downloaded_at: new Date().toISOString(),
      cache_dir: cacheDir
    })
  );
  
  return cacheDir;
};
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

```javascript
const trackPortraitView = async (portraitId, duration) => {
  try {
    await fetch(`${API_BASE_URL}/api/mobile/portraits/${portraitId}/view`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        timestamp: new Date().toISOString(),
        duration_seconds: Math.round(duration),
        device_info: {
          platform: Platform.OS,
          os_version: Platform.Version.toString(),
          app_version: APP_VERSION
        }
      })
    });
  } catch (error) {
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
    await queueOfflineEvent('portrait_view', {
      portraitId,
      duration,
      timestamp: new Date().toISOString()
    });
  }
};
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è AR.js –≤ WebView

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - WebView –º–µ–¥–ª–µ–Ω–Ω–µ–µ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ AR
2. **–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ** - –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
3. **–†–∞–∑–º–µ—Ä –º–∞—Ä–∫–µ—Ä–æ–≤** - –±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å—Å—è
4. **–û—Å–≤–µ—â–µ–Ω–∏–µ** - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ö–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º

1. **–ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å** - –≤—ã—Å–æ–∫–æ–∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª—É—á—à–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è
2. **–î–µ—Ç–∞–ª–∏** - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –¥–µ—Ç–∞–ª–µ–π —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ
3. **–†–∞–∑–º–µ—Ä** - –º–∏–Ω–∏–º—É–º 640x480px, –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ 1280x720px
4. **–ò–∑–±–µ–≥–∞—Ç—å** - –æ–¥–Ω–æ—Ç–æ–Ω–Ω—ã–µ, —Ä–∞–∑–º—ã—Ç—ã–µ, —Å –±–ª–∏–∫–∞–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ

1. **–ö–æ–¥–µ–∫** - H.264 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
2. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä** - MP4
3. **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ** - 720p (–±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Ä–∞–∑–º–µ—Ä–∞)
4. **–ë–∏—Ç—Ä–µ–π—Ç** - 2-3 Mbps (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ)
5. **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 15-30 —Å–µ–∫—É–Ω–¥

---

## üöÄ Roadmap –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### MVP (v1.0)
- ‚úÖ –°–ø–∏—Å–æ–∫ –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤ —Å preview
- ‚úÖ AR –ø—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ WebView
- ‚úÖ QR –∫–æ–¥ —Å–∫–∞–Ω–µ—Ä
- ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–µ—à –º–∞—Ä–∫–µ—Ä–æ–≤
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

### v1.1
- üìã –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º —Å –æ—á–µ—Ä–µ–¥—å—é —Å–æ–±—ã—Ç–∏–π
- üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º (–æ—á–∏—Å—Ç–∫–∞, –≤—ã–±–æ—Ä–æ—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
- üìã –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º
- üìã –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

### v1.2
- üìã –ù–∞—Ç–∏–≤–Ω—ã–π AR (ARCore/ARKit)
- üìã –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- üìã –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ
- üìã –°–æ—Ü–∏–∞–ª—å–Ω—ã–π —à–µ—Ä–∏–Ω–≥

### v2.0
- üìã –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- üìã –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ
- üìã –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- üìã Dark mode

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- Email: dev@vertex-ar.example.com
- GitHub Issues: [github.com/vertex-ar/issues](https://github.com/vertex-ar/issues)
- API Documentation: https://example.com/api/docs

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0
