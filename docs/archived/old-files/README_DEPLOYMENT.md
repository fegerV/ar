# Vertex-AR Упрощенное развертывание

## Обзор

Этот документ описывает упрощенный подход к развертыванию Vertex-AR, основанный на подходах из проекта Stogram. Основная цель - упростить развертывание и уменьшить количество зависимостей.

## Отличия от оригинальной версии

### Упрощения:
- Использование SQLite вместо PostgreSQL
- Локальное файловое хранилище вместо MinIO
- Упрощенная аутентификация (без JWT)
- Меньше зависимостей (7 vs 15)
- Проще развертывание (1 контейнер vs 4)

### Технологии:
- FastAPI
- SQLite
- Локальное файловое хранилище
- Python 3.9

## Быстрый старт

### Вариант 1: Локальный запуск (упрощенный)

```bash
# 1. Установка зависимостей
pip install -r vertex-ar/requirements-simple.txt

# 2. Запуск приложения
cd vertex-ar
./start.sh

# Приложение будет доступно на http://localhost:8000
```

### Вариант 2: Docker развертывание (упрощенное)

```bash
# 1. Сборка и запуск
docker compose up -d

# 2. Создание администратора
curl -X POST http://localhost:8000/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"Admin123!"}'

# Приложение будет доступно на http://localhost:8000
```

## Архитектура

```
┌─────────────────────────────────┐
│    FastAPI Application          │
├─────────────────────────────────┤
│  ┌────────────┐  ┌────────────┐ │
│  │ Simple Auth│  │ AR Content │ │
│  │            │  │  Manager   │ │
│  └────────────┘  └────────────┘ │
├─────────────────────────────────┤
│   Database (SQLite)             │
├─────────────────────────────────┤
│  ┌────────┐  ┌────────────────┐ │
│  │ Users  │  │   ar_content   │ │
│  └────────┘  └────────────────┘ │
└─────────────────────────────────┘
         │
    ┌────▼────────┐
    │    Local    │
    │  Filesystem │
    └─────────────┘
```

## Структура проекта

```
vertex-ar/
├── main.py                    # Главное приложение FastAPI (упрощенное)
├── start.sh                   # Скрипт запуска
├── requirements-simple.txt    # Упрощенные зависимости
├── storage/                   # Локальное хранилище файлов
│   └── ar_content/
│       └── {username}/
│           └── {content_id}/
│               ├── image_*
│               ├── video_*
│               └── markers/
└── static/
    └── admin.html
```

## Зависимости

| Библиотека | Назначение |
|------------|------------|
| fastapi | Web framework |
| uvicorn | ASGI server |
| python-multipart | Обработка multipart данных |
| pydantic | Валидация данных |
| qrcode[pil] | Генерация QR-кодов |
| Pillow | Обработка изображений |
| python-dotenv | Управление переменными окружения |
| sqlalchemy | ORM (упрощенное использование) |
| sqlite3 | Встроенная база данных |

## Команды для разработки

```bash
# Сборка Docker образов
make build

# Запуск сервисов
make up

# Просмотр логов
make logs

# Остановка сервисов
make down

# Статус сервисов
make status

# Создание администратора
make create-admin
```

## Развертывание на сервере

```bash
# 1. Клонирование репозитория
git clone <repository-url>

# 2. Установка и запуск
make deploy

# 3. Создание администратора
make create-admin
```

## Миграция данных

Если вы переходите с оригинальной версии Vertex-AR, используйте следующий подход:

1. Экспортируйте данные из PostgreSQL
2. Импортируйте в SQLite используя соответствующий скрипт
3. Переместите файлы из MinIO в локальное хранилище

## Безопасность

В упрощенной версии:
- Используется SHA256 для хэширования паролей (в продакшене рекомендуется bcrypt)
- Простые токены в памяти
- Открытые CORS (в продакшене настройте ограничения)

## Мониторинг

```bash
# Проверка статуса
make health

# Просмотр логов
make logs-app

# Вход в контейнер
make shell-app
```

## Резервное копирование

```bash
# Резервное копирование базы данных
make backup-db
```

## Обновление

```bash
# Обновление приложения
make update
```

## Сравнение с оригинальной версией

| Характеристика | Оригинал | Упрощенный |
|----------------|----------|------------|
| Зависимости | 15 | 7 |
| Контейнеры | 4 (app, postgres, minio, nginx) | 2 (app, nginx) |
| База данных | PostgreSQL | SQLite |
| Хранилище | MinIO | Локальное |
| Сложность развертывания | Высокая | Низкая |
| Объем кода | 451 строк | ~440 строк |
| Внешние сервисы | 3 (MinIO, PostgreSQL) | 0 |

## Поддержка

- [GitHub Issues](https://github.com/your-repo/issues)
- [Документация API](http://localhost:8000/docs)

## Заключение

Упрощенная версия Vertex-AR сохраняет все основные функции:
- ✅ Загрузка изображений и видео
- ✅ Генерация AR страниц
- ✅ AR.js NFT маркеры для отслеживания
- ✅ QR коды для быстрого доступа
- ✅ Админ панель
- ✅ Аутентификация

Но при этом:
- ❌ Без внешних зависимостей
- ❌ Без сложного развертывания
- ❌ Без блокчейна и NFT
- ❌ Без IPFS