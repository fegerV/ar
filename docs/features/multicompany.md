# Multi-Company Support –¥–ª—è Vertex AR

## –û–ø–∏—Å–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª Multi-Company Support –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ Vertex AR –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ö–∞–∂–¥–∞—è –∫–æ–º–ø–∞–Ω–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤, –ø–æ—Ä—Ç—Ä–µ—Ç—ã –∏ –≤–∏–¥–µ–æ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–º–ø–∞–Ω–∏—è "Vertex AR".

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ Companies
```sql
CREATE TABLE companies (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL UNIQUE,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
)
```

### –°–≤—è–∑—å —Å Clients
–¢–∞–±–ª–∏—Ü–∞ `clients` —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `company_id`, –∫–æ—Ç–æ—Ä–æ–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é:
```sql
ALTER TABLE clients ADD COLUMN company_id TEXT NOT NULL;
ALTER TABLE clients ADD FOREIGN KEY(company_id) REFERENCES companies(id) ON DELETE CASCADE;
ALTER TABLE clients ADD CONSTRAINT unique_company_phone UNIQUE(company_id, phone);
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –ö–∞–∂–¥—ã–π –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
- –ù–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–º–ø–∞–Ω–∏–∏, –Ω–æ –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ—Ä—Ç—Ä–µ—Ç—ã –∏ –≤–∏–¥–µ–æ

## API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
```
POST /companies
Content-Type: application/json

{
    "name": "Avangard"
}

Response:
{
    "id": "company-1a2b3c4d",
    "name": "Avangard",
    "created_at": "2024-11-19T10:00:00"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π
```
GET /companies

Response:
{
    "items": [
        {
            "id": "vertex-ar-default",
            "name": "Vertex AR",
            "created_at": "2024-11-19T09:00:00",
            "client_count": 42
        },
        {
            "id": "company-1a2b3c4d",
            "name": "Avangard",
            "created_at": "2024-11-19T10:00:00",
            "client_count": 15
        }
    ],
    "total": 2
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏–∏
```
GET /companies/{company_id}

Response:
{
    "id": "company-1a2b3c4d",
    "name": "Avangard",
    "created_at": "2024-11-19T10:00:00"
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
```
DELETE /companies/{company_id}

Response:
{
    "message": "Company 'Avangard' deleted successfully"
}
```

**–í–∞–∂–Ω–æ:** –ö–æ–º–ø–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Vertex AR" (id: vertex-ar-default) –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–∞.

### –í—ã–±–æ—Ä/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
```
POST /companies/{company_id}/select

Response:
{
    "id": "company-1a2b3c4d",
    "name": "Avangard",
    "created_at": "2024-11-19T10:00:00"
}
```

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏—è–º–∏ –≤ Admin Dashboard

–ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏—è–º–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –ø–æ–¥ "System Information" –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç:

1. **–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∫–æ–º–ø–∞–Ω–∏–∏** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ª–µ–≤–∞ –∫—Ä—É–ø–Ω—ã–º —Å–∏–Ω–∏–º —Ç–µ–∫—Å—Ç–æ–º (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Vertex AR")

2. **–í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫** - –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–æ–º–ø–∞–Ω–∏—é –∏–∑ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
   - –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –µ–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ—Ä—Ç—Ä–µ—Ç—ã, –∑–∞–∫–∞–∑—ã)

3. **–ö–Ω–æ–ø–∫–∞ "+"** - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
   - –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
   - –ü–æ—Å–ª–µ –≤–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É ‚úì –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è
   - –ö–Ω–æ–ø–∫–∞ ‚úï –¥–ª—è –æ—Ç–º–µ–Ω—ã

4. **–ö–Ω–æ–ø–∫–∞ "üóë" (—É–¥–∞–ª–µ–Ω–∏—è)** - —É–¥–∞–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–ø–∞–Ω–∏—é
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - –ó–∞–ø—Ä–µ—â–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "Vertex AR"
   - –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

```javascript
// –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π
loadCompanies();

// –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
showAddCompanyForm();

// –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏  
hideAddCompanyForm();

// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é
createCompany();

// –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –∫–æ–º–ø–∞–Ω–∏—é
switchCompany();

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è
showDeleteCompanyModal();

// –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è
hideDeleteCompanyModal();

// –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
confirmDeleteCompany();
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `companies` –µ—Å–ª–∏ –µ–µ –µ—â–µ –Ω–µ—Ç
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–º–ø–∞–Ω–∏—è "Vertex AR" —Å id `vertex-ar-default` –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç
3. –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –±–µ–∑ company_id –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ –∫–æ–º–ø–∞–Ω–∏—é "Vertex AR" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏

```python
database.create_client(
    client_id="client-123",
    phone="79998887766",
    name="–ò–≤–∞–Ω –°–∏–¥–æ—Ä–æ–≤",
    company_id="company-1a2b3c4d"  # Avangard
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –∫–æ–º–ø–∞–Ω–∏–∏

```python
clients = database.list_clients(
    company_id="company-1a2b3c4d"  # –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—ã Avangard
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏ –∫–æ–º–ø–∞–Ω–∏–∏

```python
client = database.get_client_by_phone(
    phone="79998887766",
    company_id="company-1a2b3c4d"  # –ü–æ–∏—Å–∫ –≤ —Ä–∞–º–∫–∞—Ö Avangard
)
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞

1. **–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ** - –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –∫–æ–º–ø–∞–Ω–∏–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º
2. **–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —É–Ω–∏–∫–∞–ª–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö –∫–æ–º–ø–∞–Ω–∏–∏** - —Ä–∞–∑–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
3. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–ø–∞–Ω–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ—Ä—Ç—Ä–µ—Ç—ã –∏ –≤–∏–¥–µ–æ
4. **–ö–æ–º–ø–∞–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–∞** - —Å–∏—Å—Ç–µ–º–∞ –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–æ–º–ø–∞–Ω–∏—é
5. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–º–ø–∞–Ω–∏—è–º–∏ —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (authToken cookie)
- –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (is_admin = True)
- –û–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è CORS –¥–ª—è –∑–∞—â–∏—Ç—ã API

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ö–æ–º–ø–∞–Ω–∏–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ companies –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ ID –∏ –∏–º–µ–Ω–∏
- –ü–æ–¥—Å—á–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GROUP BY

## –ë—É–¥—É—â–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

–ü–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. –†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∫–æ–º–ø–∞–Ω–∏–π
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏ (–ª–æ–≥–æ—Ç–∏–ø, —Ü–≤–µ—Ç–∞, –±–∏–ª–ª–∏–Ω–≥)
3. API –∫–ª—é—á–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
4. –û—Ç—á–µ—Ç—ã –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º
5. –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –ø—Ä–æ–±–ª–µ–º –∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É Vertex AR.
