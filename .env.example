# Vertex AR - Production Environment Variables Template
# Copy this file to .env and update with your production values

# ============================================
# Application Settings
# ============================================

# Debug mode (MUST be False in production)
DEBUG=False

# Secret key for JWT tokens - MUST be changed in production!
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECRET_KEY=CHANGE_ME_TO_A_SECURE_RANDOM_KEY_IN_PRODUCTION

# Application host and port
APP_HOST=0.0.0.0
APP_PORT=8000

# Base URL for the application (used for generating AR URLs and QR codes)
# Example: https://yourdomain.com
BASE_URL=http://localhost:8000

# Internal health check URL (optional)
# Used for web server health monitoring when BASE_URL points to an external domain
# If blank, system will auto-build from APP_HOST/APP_PORT (e.g., http://localhost:8000)
# Example: http://localhost:8000 or http://127.0.0.1:8000
INTERNAL_HEALTH_URL=

# Environment name (development, staging, production)
ENVIRONMENT=production

# ============================================
# Database Settings
# ============================================

# SQLite database path (relative to application directory)
DATABASE_URL=sqlite:///./app_data.db

# For PostgreSQL (recommended for production):
# DATABASE_URL=postgresql://user:password@localhost:5432/vertex_ar

# ============================================
# Storage Settings
# ============================================

# Storage type: "local" or "minio"
STORAGE_TYPE=local

# Local storage path
STORAGE_PATH=./storage

# ============================================
# MinIO/S3 Settings (if STORAGE_TYPE=minio)
# ============================================

MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=CHANGE_ME_IN_PRODUCTION
MINIO_BUCKET=vertex-ar
MINIO_SECURE=True
MINIO_PUBLIC_URL=

# ============================================
# Security Settings
# ============================================

# CORS allowed origins (comma-separated)
# IMPORTANT: Change this in production to your actual domain(s)
# Example: https://yourdomain.com,https://www.yourdomain.com
CORS_ORIGINS=http://localhost:8000,http://127.0.0.1:8000

# Session timeout in minutes
SESSION_TIMEOUT_MINUTES=30

# Maximum failed authentication attempts before lockout
AUTH_MAX_ATTEMPTS=5

# Account lockout duration in minutes
AUTH_LOCKOUT_MINUTES=15

# Token expiration time in hours
TOKEN_EXPIRATION_HOURS=24

# Bcrypt password hashing rounds (higher = more secure but slower)
BCRYPT_ROUNDS=12

# Default admin credentials (auto-seeded for admin panel access)
DEFAULT_ADMIN_USERNAME=superar
DEFAULT_ADMIN_PASSWORD=ffE48f0ns@HQ
DEFAULT_ADMIN_EMAIL=superar@vertex-ar.local
DEFAULT_ADMIN_FULL_NAME=Super Administrator

# Legacy admin credentials (used by legacy auth modules if needed)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=CHANGE_ME_IN_PRODUCTION

# ============================================
# Rate Limiting
# ============================================

# Enable rate limiting (recommended: true)
RATE_LIMIT_ENABLED=true

# Global rate limit (requests per time period)
GLOBAL_RATE_LIMIT=100/minute

# Auth endpoints rate limit
AUTH_RATE_LIMIT=5/minute

# Upload endpoints rate limit
UPLOAD_RATE_LIMIT=10/minute

# ============================================
# Logging
# ============================================

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Use JSON formatted logs (recommended for production)
JSON_LOGS=true

# ============================================
# Monitoring and Error Tracking
# ============================================

# Sentry DSN for error tracking (optional but recommended)
# Get from: https://sentry.io
SENTRY_DSN=

# Sentry environment name
SENTRY_ENVIRONMENT=production

# Sentry traces sample rate (0.0 to 1.0)
SENTRY_TRACES_SAMPLE_RATE=0.1

# ============================================
# File Upload Limits
# ============================================

# Maximum image size in MB
MAX_IMAGE_SIZE_MB=10

# Maximum video size in MB
MAX_VIDEO_SIZE_MB=50

# Allowed image formats (comma-separated)
ALLOWED_IMAGE_FORMATS=jpg,jpeg,png

# Allowed video formats (comma-separated)
ALLOWED_VIDEO_FORMATS=mp4,webm

# ============================================
# NFT Marker Generation
# ============================================

# Feature density: low, medium, or high
NFT_FEATURE_DENSITY=high

# Number of pyramid levels (1-3)
NFT_PYRAMID_LEVELS=3

# Target DPI for marker generation
NFT_TARGET_DPI=150

# ============================================
# Telegram Notifications (Optional)
# ============================================

# Telegram Bot Token (get from @BotFather)
TELEGRAM_BOT_TOKEN=

# Telegram Chat ID
TELEGRAM_CHAT_ID=

# ============================================
# Email Notifications (Optional)
# ============================================

# ⚠️  SECURITY WARNING: SMTP_USERNAME and SMTP_PASSWORD are DEPRECATED! ⚠️
# 
# Environment-based SMTP credentials are insecure and will be removed in a future release.
# These variables are ONLY supported for initial bootstrapping and will cause the
# application to refuse to start in production mode.
#
# ✅ RECOMMENDED: Configure SMTP credentials via the admin UI at:
#    /admin/notification-settings
# 
# The admin UI stores credentials encrypted in the database, providing:
#   - Encrypted storage using industry-standard encryption
#   - Audit logging of all configuration access
#   - Secure rotation without server restarts
#   - Protection from environment variable exposure
#
# See docs/EMAIL_MIGRATION.md for migration instructions.

# SMTP server configuration (public/non-sensitive settings)
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
EMAIL_FROM=your-email@gmail.com

# DEPRECATED - DO NOT USE IN PRODUCTION
# Remove these after migrating to admin UI configuration
#SMTP_USERNAME=your-email@gmail.com
#SMTP_PASSWORD=your-app-password

# Admin emails (comma-separated)
ADMIN_EMAILS=admin@example.com,ops@example.com

# Email queue settings (persistent queue for reliable delivery)
# Number of concurrent workers processing emails (default: 3)
EMAIL_QUEUE_WORKERS=3

# Email retry settings
# Maximum retry attempts for failed emails (default: 3)
EMAIL_MAX_RETRIES=3
# Retry delay in minutes, uses exponential backoff: 2^attempt minutes (default behavior)
# Attempt 1: 2 minutes, Attempt 2: 4 minutes, Attempt 3: 8 minutes

# ============================================
# Monitoring and Alerting
# ============================================

# Enable monitoring and alerting system
ALERTING_ENABLED=true

# Alert thresholds (percentages)
CPU_THRESHOLD=80.0
MEMORY_THRESHOLD=85.0
DISK_THRESHOLD=90.0

# Health check interval (seconds)
HEALTH_CHECK_INTERVAL=60

# Weekly report schedule
WEEKLY_REPORT_DAY=monday
WEEKLY_REPORT_TIME=09:00

# ============================================
# Redis (Optional - for caching and sessions)
# ============================================

# Redis URL
REDIS_URL=redis://localhost:6379/0

# Redis password
REDIS_PASSWORD=

# ============================================
# Backup Settings
# ============================================

# Backup destination (local, s3)
BACKUP_DESTINATION=local

# Backup retention days
BACKUP_RETENTION_DAYS=7

# S3 backup settings (if BACKUP_DESTINATION=s3)
BACKUP_S3_BUCKET=
BACKUP_S3_REGION=us-east-1
BACKUP_S3_ACCESS_KEY=
BACKUP_S3_SECRET_KEY=

# ============================================
# Video Scheduler Settings
# ============================================

# Enable video animation scheduler
VIDEO_SCHEDULER_ENABLED=true

# Check interval in seconds (default: 300 = 5 minutes)
VIDEO_SCHEDULER_CHECK_INTERVAL=300

# Rotation interval in seconds (default: 3600 = 1 hour)
VIDEO_SCHEDULER_ROTATION_INTERVAL=3600

# Archive videos after hours (default: 168 = 1 week)
VIDEO_SCHEDULER_ARCHIVE_AFTER_HOURS=168

# Enable video scheduler notifications
VIDEO_SCHEDULER_NOTIFICATIONS_ENABLED=true

# ============================================
# Lifecycle Scheduler Settings
# ============================================

# Enable lifecycle scheduler for automatic status transitions
LIFECYCLE_SCHEDULER_ENABLED=true

# Check interval in seconds (default: 3600 = 1 hour)
LIFECYCLE_CHECK_INTERVAL_SECONDS=3600

# Enable lifecycle notifications (7-day, 24-hour, post-expiry alerts)
LIFECYCLE_NOTIFICATIONS_ENABLED=true

# ============================================
# Cache Settings
# ============================================

# Enable/disable caching system
CACHE_ENABLED=true

# Redis connection URL (optional - if not set, uses in-memory LRU cache)
# Format: redis://[:password@]host[:port][/database]
# Examples:
#   redis://localhost:6379/0
#   redis://:mypassword@redis-server:6379/1
#   redis://redis.example.com:6379
# REDIS_URL=redis://localhost:6379/0

# Cache TTL (time-to-live) in seconds
# Default: 300 (5 minutes)
CACHE_TTL=300

# Cache namespace prefix for all keys
# Useful for isolating cache data when multiple instances share Redis
CACHE_NAMESPACE=vertex_ar

# Maximum cache size for in-memory LRU cache (entries)
# Only applies when Redis is not available
CACHE_MAX_SIZE=1000

# Default page size for paginated queries
CACHE_PAGE_SIZE_DEFAULT=50

# Maximum allowed page size for paginated queries
CACHE_PAGE_SIZE_MAX=200

# ============================================
# Yandex Disk Storage Tuning
# ============================================
# These settings optimize Yandex Disk performance for large media files

# Request timeout in seconds (default: 30)
# Increase for slow/unreliable networks
YANDEX_REQUEST_TIMEOUT=30

# Chunk size for uploads/downloads in megabytes (default: 10)
# Larger chunks = faster transfers but more memory usage
# Recommended: 5-20 MB for photos, 10-50 MB for videos
# Small files (<chunk size) are transferred directly without chunking
YANDEX_CHUNK_SIZE_MB=10

# Max concurrent chunk uploads (default: 3)
# Higher values = faster uploads but more CPU/memory usage
# Recommended: 2-5 for most deployments
YANDEX_UPLOAD_CONCURRENCY=3

# Directory cache TTL in seconds (default: 300 = 5 minutes)
# Caches directory existence checks to reduce API calls
# Lower values = more up-to-date but more API requests
YANDEX_DIRECTORY_CACHE_TTL=300

# Maximum directory cache entries (default: 1000)
# LRU cache size - increase for complex folder structures
YANDEX_DIRECTORY_CACHE_SIZE=1000

# HTTP connection pool settings for persistent session
# Pool connections (default: 10) - connections kept alive
YANDEX_SESSION_POOL_CONNECTIONS=10
# Pool max size (default: 20) - maximum concurrent connections
YANDEX_SESSION_POOL_MAXSIZE=20

# TUNING GUIDELINES:
# - For high-traffic deployments with many concurrent users:
#   Increase YANDEX_SESSION_POOL_MAXSIZE to 50+
# - For large media files (100MB+ videos):
#   Increase YANDEX_CHUNK_SIZE_MB to 20-50
#   Increase YANDEX_REQUEST_TIMEOUT to 60+
# - For memory-constrained environments:
#   Decrease YANDEX_CHUNK_SIZE_MB to 5
#   Decrease YANDEX_UPLOAD_CONCURRENCY to 2
# - For complex folder hierarchies (1000+ folders):
#   Increase YANDEX_DIRECTORY_CACHE_SIZE to 5000+

# ============================================
# Uvicorn Web Server Tuning
# ============================================
# These settings optimize uvicorn performance for production workloads

# Number of worker processes (default: (2 * CPU cores) + 1)
# Auto-calculated from CPU count if not set
# Recommendation: Use default for balanced workloads
#                 Increase for CPU-bound tasks
#                 Decrease for memory-constrained environments
# UVICORN_WORKERS=5

# Keep-alive timeout in seconds (default: 5)
# Time to keep idle connections open
# Lower values free resources faster, higher values reduce connection overhead
UVICORN_KEEPALIVE_TIMEOUT=5

# Alternative keep-alive setting (default: 5)
# Same as UVICORN_KEEPALIVE_TIMEOUT, use either one
UVICORN_TIMEOUT_KEEP_ALIVE=5

# Limit concurrent connections (default: 0 = unlimited)
# Set to limit total concurrent requests (prevents overload)
# Example: 1000 for high-traffic sites
UVICORN_LIMIT_CONCURRENCY=0

# Connection backlog size (default: 2048)
# Queue size for pending connections
# Increase for high-traffic deployments (e.g., 4096)
UVICORN_BACKLOG=2048

# Enable proxy headers (default: true)
# Required when behind reverse proxy (nginx, haproxy, etc.)
# Enables proper client IP detection via X-Forwarded-* headers
UVICORN_PROXY_HEADERS=true

# Graceful shutdown timeout in seconds (default: 30)
# Time to wait for active requests to complete during shutdown
# Increase if you have long-running requests
UVICORN_TIMEOUT_GRACEFUL_SHUTDOWN=30

# ============================================
# Web Server Health Check Tuning
# ============================================
# These settings optimize health check behavior for monitoring

# Health check request timeout in seconds (default: 5)
# Max time to wait for /health endpoint response
WEB_HEALTH_CHECK_TIMEOUT=5

# Use HEAD requests for health checks (default: false)
# HEAD requests are lighter than GET (no response body)
# Enable to reduce monitoring load on high-traffic systems
WEB_HEALTH_CHECK_USE_HEAD=false

# Cooldown between health checks in seconds (default: 30)
# Minimum time between consecutive health check attempts
# Prevents monitoring from overwhelming the server
WEB_HEALTH_CHECK_COOLDOWN=30

# TUNING GUIDELINES:
# - For high-traffic production:
#   * UVICORN_WORKERS: Use (2 * CPU cores) + 1 or higher
#   * UVICORN_LIMIT_CONCURRENCY: Set to 500-1000 per worker
#   * UVICORN_BACKLOG: Increase to 4096 or higher
#   * WEB_HEALTH_CHECK_USE_HEAD: Enable (true) to reduce monitoring overhead
# 
# - For memory-constrained environments:
#   * UVICORN_WORKERS: Reduce to 2-4
#   * UVICORN_LIMIT_CONCURRENCY: Set lower limit (e.g., 100)
#   * UVICORN_KEEPALIVE_TIMEOUT: Reduce to 2-3 seconds
# 
# - For long-running requests (uploads, video processing):
#   * UVICORN_TIMEOUT_GRACEFUL_SHUTDOWN: Increase to 60-120 seconds
#   * WEB_HEALTH_CHECK_TIMEOUT: Increase to 10-15 seconds
# 
# - For development/testing:
#   * UVICORN_WORKERS: Set to 1 for easier debugging
#   * WEB_HEALTH_CHECK_COOLDOWN: Reduce to 10-15 seconds for faster feedback

# ============================================
# IMPORTANT PRODUCTION CHECKLIST
# ============================================

# Before deploying to production, make sure:
# 1. ✅ DEBUG=False
# 2. ✅ SECRET_KEY is changed to a strong random value
# 3. ✅ ADMIN_PASSWORD is changed
# 4. ✅ CORS_ORIGINS is set to your actual domain(s)
# 5. ✅ MINIO_SECRET_KEY is changed (if using MinIO)
# 6. ✅ RATE_LIMIT_ENABLED=true
# 7. ✅ SENTRY_DSN is configured (for error tracking)
# 8. ✅ ENVIRONMENT=production
# 9. ✅ Use PostgreSQL instead of SQLite
# 10. ✅ Configure automated backups
# 11. ✅ Set up monitoring and alerting (ALERTING_ENABLED=true)
# 12. ✅ Configure SMTP/Telegram for notifications
