# Changelog: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Nginx

## [Bugfix] - 2025-01-XX

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- üêõ **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Nginx –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è** –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- üêõ **–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**: nginx —Ç—Ä–µ–±–æ–≤–∞–ª –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ `/etc/nginx/ssl/cert.pem` –∏ `key.pem`
- üêõ **–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞**: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS –±–µ–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- üêõ **–°—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π MinIO**: proxy_pass –Ω–∞ `minio:9000` –≤—ã–∑—ã–≤–∞–ª –æ—à–∏–±–∫–∏

### –î–æ–±–∞–≤–ª–µ–Ω–æ

#### nginx.conf
- ‚úÖ –†–∞–±–æ—á–∞—è HTTP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 80
- ‚úÖ MIME-—Ç–∏–ø—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (access.log, error.log)
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:
  - `client_max_body_size 500M`
  - –¢–∞–π–º–∞—É—Ç—ã 300s –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ Healthcheck endpoint `/health` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ proxy headers –¥–ª—è FastAPI
- ‚úÖ HTTPS –±–ª–æ–∫ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (–≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)

#### docker-compose.yml
- ‚úÖ Healthcheck –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Nginx
  - –ò–Ω—Ç–µ—Ä–≤–∞–ª: 30s
  - –¢–∞–π–º–∞—É—Ç: 10s
  - –ü–æ–≤—Ç–æ—Ä—ã: 3
  - –ù–∞—á–∞–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥: 40s
- ‚úÖ Volume –¥–ª—è –ª–æ–≥–æ–≤ `nginx_logs`
- ‚úÖ Read-only –º–æ–Ω—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`:ro`)
- ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∫–∞ `./ssl`

#### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- üìÑ **BUGFIX_SUMMARY.md** - –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- üìÑ **NGINX_FIX.md** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (750+ —Å—Ç—Ä–æ–∫)
- üìÑ **docs/deployment/nginx-ssl-setup.md** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ HTTPS (350+ —Å—Ç—Ä–æ–∫)
  - –°–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è dev
  - Let's Encrypt –¥–ª—è production
  - Certbot –≤ Docker
  - Troubleshooting
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ SSL

#### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- üîß **scripts/test-nginx-config.sh** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL –Ω–∞—Å—Ç—Ä–æ–µ–∫
  - –í–∞–ª–∏–¥–∞—Ü–∏—è docker-compose.yml
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- üîß **docker-compose.test.yml** - –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è Nginx
- üîß **nginx.test.conf** - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–æ

#### nginx.conf
- ‚ö†Ô∏è **–£–¥–∞–ª–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π HTTPS** - —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π
- ‚ö†Ô∏è **–£–¥–∞–ª–µ–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç** HTTP ‚Üí HTTPS
- ‚ö†Ô∏è **–£–¥–∞–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ MinIO** - —É–ø—Ä–æ—â–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### docker-compose.yml
- ‚ö†Ô∏è **–£–¥–∞–ª–µ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∫–∞ `./ssl`** - —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `nginx.conf` (82 ‚Üí 110 —Å—Ç—Ä–æ–∫)
- `docker-compose.yml` (38 ‚Üí 50 —Å—Ç—Ä–æ–∫)

**–§–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã:**
- `BUGFIX_SUMMARY.md` (170 —Å—Ç—Ä–æ–∫)
- `NGINX_FIX.md` (280 —Å—Ç—Ä–æ–∫)
- `CHANGELOG_NGINX_FIX.md` (—Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª)
- `docs/deployment/nginx-ssl-setup.md` (350 —Å—Ç—Ä–æ–∫)
- `scripts/test-nginx-config.sh` (200 —Å—Ç—Ä–æ–∫, –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π)
- `docker-compose.test.yml` (50 —Å—Ç—Ä–æ–∫)
- `nginx.test.conf` (30 —Å—Ç—Ä–æ–∫)

**–í—Å–µ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~1080 —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–¥–∞

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ** - –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:
- –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ FastAPI
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ `/storage/`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

### –ú–∏–≥—Ä–∞—Ü–∏—è

#### –î–ª—è –Ω–æ–≤—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫
```bash
# –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d
```

#### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫ —Å SSL
1. **–û–ø—Ü–∏—è 1**: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
   ```bash
   # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å HTTPS –±–ª–æ–∫ –≤ nginx.conf (—Å—Ç—Ä–æ–∫–∏ 63-108)
   # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∫—É –≤ docker-compose.yml (—Å—Ç—Ä–æ–∫–∞ 36)
   docker compose restart nginx
   ```

2. **–û–ø—Ü–∏—è 2**: –ù–∞—á–∞—Ç—å —Å HTTP, –¥–æ–±–∞–≤–∏—Ç—å HTTPS –ø–æ–∑–∂–µ
   ```bash
   # –ù–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
   docker compose up -d
   # –ü–æ–∑–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å HTTPS –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
   ```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
```bash
./scripts/test-nginx-config.sh
```

#### –†—É—á–Ω–æ–µ
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
docker compose exec nginx nginx -t

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ healthcheck
curl http://localhost/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs nginx
```

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- ‚ö†Ô∏è HTTPS –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
- ‚ö†Ô∏è –ü–æ—Ä—Ç 80 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≤–æ–±–æ–¥–µ–Ω (–∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π)
- ‚ö†Ô∏è MinIO –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTP –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ HTTPS –¥–ª—è production (—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é)
3. ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏: `docker compose logs nginx`
4. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ healthcheck: `docker compose ps nginx`
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ Let's Encrypt (—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é)

### –°—Å—ã–ª–∫–∏

- [–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ](BUGFIX_SUMMARY.md)
- [–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ](NGINX_FIX.md)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL](docs/deployment/nginx-ssl-setup.md)
- [–°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](scripts/test-nginx-config.sh)

### –£—á–∞—Å—Ç–Ω–∏–∫–∏

- **–ê–≤—Ç–æ—Ä**: AI Assistant
- **–í–µ—Ç–∫–∞**: `bugfix/docker-nginx-restart-loop`
- **–¢–∏–∫–µ—Ç**: Nginx –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Docker

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**
