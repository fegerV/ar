# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Docker Nginx –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Nginx –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ `docker compose up`.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `nginx.conf`
- ‚ùå **–£–¥–∞–ª–µ–Ω–æ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTPS —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
- ‚ùå **–£–¥–∞–ª–µ–Ω–æ**: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç HTTP ‚Üí HTTPS
- ‚ùå **–£–¥–∞–ª–µ–Ω–æ**: Proxy –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É MinIO —Å–µ—Ä–≤–∏—Å—É
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: –†–∞–±–æ—á–∞—è HTTP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –ø–æ—Ä—Ç—É 80
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (500MB)
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: Healthcheck endpoint `/health`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: HTTPS –±–ª–æ–∫ –≤ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (–≥–æ—Ç–æ–≤ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docker-compose.yml`
- ‚ùå **–£–¥–∞–ª–µ–Ω–æ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∫–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./ssl`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: Healthcheck –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è Nginx
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: Volume –¥–ª—è –ª–æ–≥–æ–≤ Nginx
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ**: Read-only –º–æ–Ω—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`:ro`)

## üìã –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

1. **`docs/deployment/nginx-ssl-setup.md`** - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HTTPS
2. **`scripts/test-nginx-config.sh`** - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **`NGINX_FIX.md`** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
4. **`docker-compose.test.yml`** - –¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Nginx

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx
docker compose logs nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
curl http://localhost/health
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./scripts/test-nginx-config.sh

# –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
docker compose exec nginx nginx -t
docker compose ps nginx
# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å "Up (healthy)"
```

## üîí –ê–∫—Ç–∏–≤–∞—Ü–∏—è HTTPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω HTTPS - —Å–º. –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é:
```bash
cat docs/deployment/nginx-ssl-setup.md
```

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —Å —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º (dev)

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
mkdir -p ssl
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout ssl/key.pem -out ssl/cert.pem \
  -subj "/CN=localhost"

# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å HTTPS –±–ª–æ–∫ –≤ nginx.conf (—Å—Ç—Ä–æ–∫–∏ 63-108)
# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∫—É SSL –≤ docker-compose.yml (—Å—Ç—Ä–æ–∫–∞ 36)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose restart nginx
```

## üìä –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

‚úÖ HTTP –Ω–∞ –ø–æ—Ä—Ç—É 80  
‚úÖ –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ FastAPI –Ω–∞ app:8000  
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ `/storage/`  
‚úÖ Healthcheck endpoint `/health`  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏  
‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤  
‚úÖ WebSocket support (–µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è)  

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **HTTPS –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω** - –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **MinIO —É–¥–∞–ª–µ–Ω** - –¥–æ–±–∞–≤—å—Ç–µ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **–ü–æ—Ä—Ç 80 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –∏–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.yml` –µ—Å–ª–∏ –∑–∞–Ω—è—Ç
- **Healthcheck —Ä–∞–±–æ—Ç–∞–µ—Ç** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π

## üîç Troubleshooting

### Nginx –≤—Å–µ –µ—â–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è?
```bash
# –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏
docker compose logs nginx --tail=100

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker compose exec nginx nginx -t

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ—Ä—Ç 80 —Å–≤–æ–±–æ–¥–µ–Ω
sudo lsof -i :80
```

### –ü–æ—Ä—Ç 80 –∑–∞–Ω—è—Ç?
–ò–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.yml`:
```yaml
ports:
  - "8080:80"  # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 8080 –≤–º–µ—Å—Ç–æ 80
```

### –ù—É–∂–µ–Ω HTTPS?
–°–º. `docs/deployment/nginx-ssl-setup.md`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ**: `NGINX_FIX.md`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL**: `docs/deployment/nginx-ssl-setup.md`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: `scripts/test-nginx-config.sh`

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**  
**–í–µ—Ç–∫–∞**: `bugfix/docker-nginx-restart-loop`  
**–î–∞—Ç–∞**: 2025-01-XX  
